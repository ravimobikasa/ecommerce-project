<%- include('partials/header.ejs') %>


<section class="">
    <div class="container mt-5">
        <% if(locals.message) { %>
            <h3 class="">
                <%= message; %>
            </h3>
        <% } %>
        <h3> Order Checkout </h3>
        <div class="mt-3">
            <div class="row">
                <div class="col-md-6">
                    <div class="card p-3">
                        <h5 class="card-title mb-2">Select Payment Method</h5>

                        <form method="post" action="/order/checkoutSession">
                            <% cardDetails.forEach((cardItem, index) =>{ %>
                                <div class="row ">
                                    <div class="col-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio"
                                                   name="cardId" <%= index === 0 ? 'checked' : '' %>
                                                   id="card_<%= cardItem.id %>" value="<%= cardItem.id %>">
                                            <label class="form-check-label" for="card_<%= cardItem.id %>">
                                                <p class="text-uppercase"> <%= cardItem.cardType %> &#183; &#183; &#183;
                                                    &#183; <%= cardItem.cardLastFour %> </p>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <p>Expiry <%= cardItem.cardExpiry %> </p>
                                    </div>
                                </div>
                            <% }) %>

                            <div class="col-6">
                                <a type="button" href="/order/stripePaymentCheckout"
                                   class="btn btn-outline-primary btn-sm px-3 rounded-pill">+ Add Payment
                                    Method</a>
                            </div>


                    </div>
                    <div class="mt-2">
                        <div class="card p-3">
                            <h5 class="card-title">Order Total</h5>
                            <div class="row mt-2">
                                <h6 class="col">Total Items</h6>
                                <p class="col">
                                    <%= totalItem; %>
                                </p>
                            </div>

                            <div class="row ">
                                <h6 class="col">Total Amount</h6>
                                <p class="col">
                                    ₹<%= totalPrice; %>
                                </p>
                            </div>

                            <button type="submit" class="btn btn-primary  btn-block rounded mt-3"
                            >Place Order
                            </button>
                        </div>
                    </div>
                    </form>
                </div>
                <div class="col-md-6 ">
                    <% products?.forEach( item=> { %>

                        <div class=" card mb-2 p-2">
                            <a href="/product/<%= item.productId; %>"
                               class="block text-reset text-decoration-none">

                                <div class="row">
                                    <div class="cart col col-md-2 overflow-hidden">
                                        <img class="img-fluid  mx-2"
                                             src="/../images/products/<%= item.Product.imageUrl %>" />
                                    </div>

                                    <div class="col col-md-10">
                                        <h5 class="mb-1">
                                            <%= item.Product.title %>
                                        </h5>

                                        <div class="d-flex flex-row">
                                            <p class="mb-0 align-self-center">Quantity:</p>
                                            <p class="ms-3 mb-0 ">
                                            <div
                                                    class="d-flex flex-row justify-content-between  align-items-center ">
                                                <p class="m-0 me-4">
                                                    <%= item.quantity; %>
                                                </p>
                                            </div>
                                            </p>
                                        </div>

                                        <div class="d-flex flex-row mt-1">
                                            <p class="mb-0">Price:</p>
                                            <p class="ms-2 mb-0">
                                                ₹<%= item.Product.price; %>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                        </div>
                        </a>
                    <% }); %>

                </div>
            </div>
        </div>
    </div>
</section>


<%- include('partials/footer.ejs') %>
